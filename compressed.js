var canvas,context,width,height;function init(){canvas=document.querySelector("canvas"),context=canvas.getContext("2d"),canvas.width=width=window.innerWidth,canvas.height=height=window.innerHeight,player.x=30,player.y=height/2,player.health=15,player.ammo=20,addEventListener("keydown",keydown),addEventListener("keyup",keyup),addEventListener("keyup",function(a){80==a.keyCode?paused=!paused:"Space"==a.code&&player.fire()}),requestAnimationFrame(animate)}function end_game(){playing=!1,alert("game over. score: "+score)}var keys={up:!1,down:!1,left:!1,right:!1};function keydown(a){switch(a.preventDefault(),a.keyCode){case 38:case 87:keys.up=!0;break;case 40:case 83:keys.down=!0;break;case 37:case 65:keys.left=!0;break;case 39:case 68:keys.right=!0;}}function keyup(a){switch(a.keyCode){case 38:case 87:keys.up=!1;break;case 40:case 83:keys.down=!1;break;case 37:case 65:keys.left=!1;break;case 39:case 68:keys.right=!1;}}var score=0,monsters=[],bullets=[],objects=[],texts=[],player={x:null,y:null,ammo:null,health:null,speed:.2,offset_x:10,offset_y:15,fire:function(){0<this.ammo&&(bullets.push(new Bullet(this.x+this.offset_x,this.y)),this.ammo--)},collision:function(){this.health--},update:function(a){var b=0,c=0;b+=keys.left?-1:0,b+=keys.right?1:0,c+=keys.up?-1:0,c+=keys.down?1:0,this.x+=b*this.speed*a,this.y+=c*this.speed*a,this.x=Math.max(this.x,this.offset_x),this.x=Math.min(this.x,200-this.offset_x),this.y=Math.max(this.y,this.offset_y),this.y=Math.min(this.y,height-this.offset_y),0>=this.health&&end_game()}};function Bullet(a,b){this.x=a,this.y=b,this.active=!0}Bullet.prototype.speed=.3,Bullet.prototype.update=function(a){this.x+=a*this.speed,this.x>width&&(this.active=!1)},Bullet.prototype.collision=function(){this.active=!1};function Monster(a,b){this.x=a,this.y=b,this.lifetime=0,this.active=!0}Monster.prototype.speed=.05,Monster.prototype.step=125,Monster.prototype.offset=15,Monster.prototype.update=function(b){this.x-=b*this.speed;var c=bullets.filter(a=>a.x>this.x-this.offset&&a.y>this.y-this.offset&&a.x<this.x+this.offset&&a.y<this.y+this.offset);0<c.length&&(c.forEach(a=>{a.collision()}),score++,.2>Math.random()&&objects.push(new Ammo_box(200*Math.random(),Math.random()*height)),this.active=!1),0>this.x&&(this.active=!1,score--)};var spawn_time=null;function spawn_monster(){monsters.push(new Monster(width,15+Math.random()*(height-30))),spawn_time+=1500*Math.random()}function Ammo_box(a,b){this.x=a,this.y=b,this.active=!0}Ammo_box.prototype.offset=10,Ammo_box.prototype.update=function(){this.x>player.x-this.offset-player.offset_x&&this.y>player.y-this.offset-player.offset_y&&this.x<player.x+this.offset+player.offset_x&&this.y<player.y+this.offset+player.offset_y&&(this.active=!1,player.ammo+=10,texts.push(new Text("+10 ammo",this.x,this.y,1500)))};function Text(a,b,c,d){this.text=a,this.x=b-11*(a.length/2),this.y=c,this.lifetime=d,this.life=0,this.active=!0,this.alpha=1}Text.prototype.update=function(a){this.life+=a,this.y-=.05*a,this.alpha=1-this.life/this.lifetime,this.life>=this.lifetime&&(this.active=!1)};var last_time=null,lapse=0,paused=!1,playing=!0;function animate(a){lapse=null==last_time?0:a-last_time,last_time=a,!paused&&playing&&(cycle(lapse),null==spawn_time?(spawn_time=a,spawn_monster()):spawn_time<a&&spawn_monster()),draw_frame(),requestAnimationFrame(animate)}function cycle(a){player.update(a),bullets=bullets.filter(a=>a.active),monsters=monsters.filter(a=>a.active),objects=objects.filter(a=>a.active),texts=texts.filter(a=>a.active),bullets.forEach(c=>{c.update(a)}),monsters.forEach(b=>{b.update(a)}),objects.forEach(b=>{b.update(a)}),texts.forEach(b=>{b.update(a)})}function draw_frame(){context.clearRect(0,0,width,height),context.strokeStyle="lightslategray",context.beginPath(),context.moveTo(200,0),context.lineTo(200,height),context.closePath(),context.stroke(),context.fillStyle="dodgerblue",context.fillRect(player.x-player.offset_x,player.y-player.offset_y,2*player.offset_x,2*player.offset_y),context.fillStyle="darkorange",bullets.forEach(a=>{context.beginPath(),context.arc(a.x,a.y,3,0,2*Math.PI,!1),context.closePath(),context.fill()}),context.fillStyle="crimson",monsters.forEach(a=>{context.fillRect(a.x-a.offset,a.y-a.offset,2*a.offset,2*a.offset)}),context.fillStyle="forestgreen",objects.forEach(a=>{context.fillRect(a.x-a.offset,a.y-a.offset,2*a.offset,2*a.offset)}),texts.forEach(a=>{context.font="14pt Arial",context.fillStyle="rgba(186, 85, 211, "+a.alpha+")",context.fillText(a.text,a.x,a.y)}),context.fillStyle="royalblue",context.font="12pt Arial",context.fillText(0==player.ammo&&0==objects.length&&0==bullets.length?"no ammo? you're screwed!":"ammo: "+player.ammo,5,30),context.fillText("score: "+score,5,50)}